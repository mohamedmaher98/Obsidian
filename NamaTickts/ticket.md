# تحليل متطلبات مستند "تغيير الخامات"

## فهم المطلوب

مطلوب إنشاء مستند جديد لإدارة تغيير الخامات في المنتجات، حيث يمكن استبدال خامة معينة أو تصنيف خامات بخامة بديلة عبر جميع مكونات المنتجات.

## هيكل المستند

### 1. رأس السند (Header)

- **دفتر**: رقم المستند أو السلسلة
- **تاريخ فعلي**: تاريخ تطبيق التغيير
- **الخامة**: الخامة الأصلية المراد تغييرها
- **تصنيف الخامة**: تصنيف الخامة الأصلية
- **الخامة البديلة**: الخامة الجديدة
- **من مكونات منتج**: المنتج المصدر
- **إلى مكونات منتج**: المنتج الهدف
- **من صنف مصنع**: الصنف الأصلي
- **إلى صنف مصنع**: الصنف الجديد

### 2. تفاصيل المستند (Details Grid)

- **Checkbox**: لاختيار السطر
- **الخامة**: عرض الخامة الحالية
- **تصنيف الخامة**: عرض التصنيف
- **الخامة البديلة**: الخامة الجديدة المقترحة

### 3. أزرار التحكم

- **تجميع المكونات**: جلب المكونات المطابقة
- **اختيار الكل**: تحديد جميع الصفوف
- **إزالة الاختيار للكل**: إلغاء جميع التحديدات
- **عكس الاختيارات**: عكس حالة التحديد

## خطوات التطوير

### المرحلة الأولى: التصميم والإعداد

- [ ] تصميم واجهة المستند
- [ ] إنشاء قاعدة البيانات للمستند الجديد
- [ ] تحديد العلاقات مع الجداول الموجودة

### المرحلة الثانية: تطوير الواجهة

- [ ] إنشاء رأس المستند مع جميع الحقول المطلوبة
- [ ] تطوير Grid التفاصيل مع Checkboxes
- [ ] إضافة أزرار التحكم فوق الـ Grid

### المرحلة الثالثة: البرمجة الوظيفية

- [ ] برمجة وظيفة "تجميع المكونات"
- [ ] برمجة أزرار الاختيار (الكل، الإلغاء، العكس)
- [ ] تطوير آلية الحفظ والتطبيق

### المرحلة الرابعة: معالجة البيانات

- [ ] برمجة خوارزمية البحث عن المكونات المطابقة
- [ ] تطوير آلية استبدال الخامات
- [ ] إنشاء نظام التتبع والـ Log

### المرحلة الخامسة: الاختبار والمراجعة

- [ ] اختبار الوظائف الأساسية
- [ ] اختبار التكامل مع النظام الموجود
- [ ] مراجعة الأمان وصحة البيانات

## الوظائف الرئيسية

### 1. تجميع المكونات

```
عند الضغط على "تجميع المكونات":
- البحث في جدول مكونات المنتجات
- فلترة النتائج حسب:
  * الخامة المختارة في الهيدر
  * تصنيف الخامة (إذا تم تحديده)
  * نطاق المنتجات (من - إلى)
  * نطاق الأصناف (من - إلى)
- عرض النتائج في الـ Grid
```

### 2. عملية التبديل

```
عند الحفظ:
- المرور على جميع الصفوف المحددة
- استبدال الخامة الأصلية بالخامة البديلة
- تحديث جداول مكونات المنتجات
- إنشاء سجل التغيير للمراجعة
```

## اعتبارات مهمة

- **النسخ الاحتياطي**: حفظ نسخة من البيانات قبل التغيير
- **المراجعة**: إمكانية التراجع عن التغييرات
- **الأمان**: صلاحيات المستخدمين
- **التتبع**: سجل التغييرات مع التاريخ والمستخدم

## جداول قاعدة البيانات المقترحة

- `MaterialChangeHeader`: رأس مستند التغيير
- `MaterialChangeDetails`: تفاصيل التغيير
- `MaterialChangeLog`: سجل التغييرات المطبقة